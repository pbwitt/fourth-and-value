<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Fourth & Value ‚Äî Methods</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark light" />
  <style>
    :root { --bg:#0f1418; --text:#e5e7eb; --muted:#9aa4af; --card:#131a20; --accent:#cbd5e1; }
    html,body { margin:0; padding:0; background:var(--bg); color:var(--text); font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial; }
    a { color:var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }
    .wrap { max-width: 980px; margin: 48px auto; padding: 0 20px; }
    .card { background:var(--card); border-radius:16px; padding:24px; box-shadow: 0 4px 16px rgba(0,0,0,.25); }
    h1 { font-size: 2rem; margin: 0 0 16px; }
    h2 { font-size: 1.25rem; margin: 28px 0 8px; }
    h3 { font-size: 1.05rem; margin: 20px 0 6px; }
    h4 { font-size: 0.95rem; margin: 16px 0 6px; }
    .updated { color: var(--muted); font-size: 0.95rem; margin-bottom: 18px; }
    ul { margin: 8px 0 8px 1.25rem; }
    ol { margin: 8px 0 8px 1.25rem; }
    code { background: rgba(255,255,255,0.06); padding: 2px 6px; border-radius: 6px; }
    pre code { display: block; padding: 12px; overflow-x: auto; }
    .note { color: var(--muted); font-size: 0.95rem; }
    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; font-size: .95em; }
    hr { border: 0; border-top: 1px solid rgba(255,255,255,.08); margin: 28px 0; }
    .highlight { background: rgba(59, 130, 246, 0.1); border-left: 3px solid #3b82f6; padding: 12px; margin: 12px 0; border-radius: 4px; }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 24px;
      border-bottom: 2px solid rgba(255,255,255,0.1);
    }
    .tab-button {
      padding: 12px 24px;
      background: transparent;
      border: none;
      color: var(--muted);
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      border-bottom: 3px solid transparent;
      margin-bottom: -2px;
      transition: all 0.2s;
    }
    .tab-button:hover {
      color: var(--text);
      background: rgba(255,255,255,0.03);
    }
    .tab-button.active {
      color: var(--text);
      border-bottom-color: #22c55e;
    }
    .tab-button.active.nhl-tab {
      border-bottom-color: #4FC3F7;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }

    /* Sport-specific highlight colors */
    .nfl-content .highlight {
      background: rgba(34, 197, 94, 0.1);
      border-left-color: #22c55e;
    }
    .nhl-content .highlight {
      background: rgba(79, 195, 247, 0.1);
      border-left-color: #4FC3F7;
    }
  </style>
</head>
<body>
  <div id="nav-root"></div>
  <script src="./nav.js?v=30"></script>

  <main class="wrap">
    <div class="card">
      <h1>Methods</h1>

      <div class="tabs">
        <button class="tab-button active" data-tab="nfl">NFL üèà</button>
        <button class="tab-button nhl-tab" data-tab="nhl">NHL üèí</button>
      </div>

      <!-- NFL Tab Content -->
      <div id="nfl-tab" class="tab-content active nfl-content">
        <div class="updated">Last updated: Oct 8, 2025</div>

        <p>This page describes how Fourth &amp; Value models NFL player props and calculates "value." It's intentionally general (no week-specific numbers) so it stays accurate as we update models.</p>

        <div class="highlight">
          <strong>üÜï Latest Update (Oct 8, 2025):</strong> Home/away field advantage adjustments are now live! We apply evidence-based multipliers (¬±3% to ¬±6%) based on game location, resulting in 6-12% spreads between home and away projections. Combined with defensive adjustments, this brings our model significantly closer to market consensus. See the Matchup Adjustments section for full details.
        </div>

        <h2 id="what-we-model">1) What we model</h2>
        <p>We focus on common player-prop markets, normalized to canonical keys (<code>market_std</code>):</p>
        <ul>
          <li><strong>Normal/Gaussian</strong>: <code>rush_yds</code>, <code>recv_yds</code>, <code>pass_yds</code>, <code>receptions</code>, <code>rush_attempts</code>, <code>pass_attempts</code>, <code>pass_completions</code>.</li>
          <li><strong>Poisson</strong>: <code>anytime_td</code>, <code>pass_tds</code>, <code>pass_interceptions</code>.</li>
        </ul>
        <p>We map sportsbook labels (e.g., "player_rushing_yards") to these keys so we can merge and compare across books.</p>

        <h2 id="data-sources">2) Data sources (high level)</h2>
        <ul>
          <li><strong>Odds (per book):</strong> Player props and prices from multiple sportsbooks via The Odds API.</li>
          <li><strong>Player game logs:</strong> Weekly player stats from nflverse (official NFL data).</li>
          <li><strong>Schedule &amp; kickoff:</strong> Used for display (ET) and filtering upcoming games.</li>
          <li><strong>Defensive stats:</strong> Computed from opponent performance (yards allowed per game).</li>
        </ul>

        <h2 id="modeling">3) Modeling approach</h2>

        <h3>Family-based multi-market modeling (Oct 2024):</h3>
        <p>Instead of modeling each market independently, we now model <strong>linked market families</strong> through shared latent factors:</p>

        <ul>
          <li><strong>Rush family:</strong> <code>rush_attempts</code> and <code>rush_yds</code> are linked through:
            <ul>
              <li>Volume latent: expected carries (Œº, œÉ)</li>
              <li>Efficiency latent: yards per carry (Œº, œÉ) bounded [2.5, 6.5]</li>
              <li>Derived relationship: <code>rush_yds = rush_attempts √ó YPC</code></li>
            </ul>
          </li>
          <li><strong>Receive family:</strong> <code>receptions</code> and <code>recv_yds</code> linked through:
            <ul>
              <li>Volume latent: expected targets</li>
              <li>Catch rate: receptions/targets bounded [0.50, 0.95]</li>
              <li>Yards per reception: bounded [6.0, 18.0]</li>
              <li>Derived: <code>recv_yds = targets √ó catch_rate √ó YPR</code></li>
            </ul>
          </li>
          <li><strong>Pass family:</strong> <code>pass_attempts</code>, <code>pass_completions</code>, and <code>pass_yds</code> linked through:
            <ul>
              <li>Volume latent: expected attempts</li>
              <li>Completion percentage: bounded [0.50, 0.75]</li>
              <li>Yards per completion: bounded [5.0, 12.0]</li>
              <li>Derived: <code>pass_yds = attempts √ó comp% √ó Y/C</code></li>
            </ul>
          </li>
        </ul>

        <p><strong>Why this matters:</strong> When a sportsbook moves the rush attempts line but not rush yards, our model detects the implied efficiency change. If a book prices 18 carries at 120 yards (6.67 YPC‚Äîabove our max bound), we know they're mispricing at least one market. This surfaces arbitrage opportunities where both linked markets show value.</p>

        <h3>Core methodology:</h3>
        <ul>
          <li><strong>Recency-weighted L4:</strong> Per player √ó market, we use only the <strong>last 4 games</strong> (L4) with <strong>exponential weighting</strong> (alpha=0.4). Most recent game receives ~64% of the total weight.</li>
          <li><strong>Normal markets:</strong> Estimate mean <code>Œº</code> and standard deviation <code>œÉ</code> ‚Üí assume <em>Normal(Œº,œÉ)</em>.</li>
          <li><strong>Poisson markets:</strong> Estimate rate <code>Œª</code> for counts (TDs, INTs) ‚Üí assume <em>Poisson(Œª)</em>.</li>
          <li><strong>Sanity guards:</strong> Efficiency metrics are bounded to realistic ranges; floor <code>œÉ</code> to avoid overconfidence.</li>
        </ul>

        <h3>Exponential weighting:</h3>
        <p>Recent games receive exponentially more weight than older games. For a 4-game window:</p>
        <ul>
          <li>Oldest game (Week N-3): <strong>10.3%</strong> weight</li>
          <li>2nd oldest (Week N-2): <strong>25.6%</strong> weight</li>
          <li>Most recent (Week N-1): <strong>64.1%</strong> weight</li>
        </ul>
        <p>This captures form changes, hot streaks, and role adjustments much faster than simple averages.</p>

        <h3>Matchup adjustments:</h3>
        <p>We apply two layers of matchup adjustments to account for both opponent strength and game location:</p>

        <h4>A. Defensive adjustments</h4>
        <p>Player projections are adjusted based on opponent defensive strength.</p>

        <p><strong>Defensive rating calculation:</strong></p>
        <ul>
          <li>Computed from <strong>current season yards allowed per game</strong> (weeks 1 to N-1)</li>
          <li>Normalized using z-scores to a <strong>0.5‚Äì2.0 scale</strong>:
            <ul>
              <li>0.5 = Easiest defense (most yards allowed)</li>
              <li>1.0 = League average defense</li>
              <li>2.0 = Toughest defense (fewest yards allowed)</li>
            </ul>
          </li>
          <li>Separate ratings for pass defense and rush defense</li>
          <li>Updated weekly as more games are played</li>
        </ul>

        <p><strong>Adjustment formula:</strong></p>
        <ul>
          <li><code>adjustment_factor = 1.0 - (def_rating - 1.0) √ó 0.3</code></li>
          <li>Applied to Œº after deriving from latent factors: <code>Œº_adjusted = Œº √ó adjustment_factor</code></li>
          <li>Market mapping:
            <ul>
              <li>Receptions, receiving yards: use <strong>pass_def_rating</strong></li>
              <li>Rush yards, rush attempts: use <strong>rush_def_rating</strong></li>
              <li>QB passing markets: use <strong>pass_def_rating</strong></li>
            </ul>
          </li>
        </ul>

        <p><strong>Examples:</strong></p>
        <ul>
          <li>Easiest defense (0.5 rating) ‚Üí <code>1.0 - (0.5 - 1.0) √ó 0.3 = 1.15</code> ‚Üí <strong>+15% boost</strong></li>
          <li>Average defense (1.0 rating) ‚Üí <code>1.0 - (1.0 - 1.0) √ó 0.3 = 1.00</code> ‚Üí <strong>No change</strong></li>
          <li>Tough defense (1.5 rating) ‚Üí <code>1.0 - (1.5 - 1.0) √ó 0.3 = 0.85</code> ‚Üí <strong>-15% penalty</strong></li>
        </ul>

        <p class="note"><em>Note: In practice, defensive ratings typically range from 0.5 to ~1.5 early in the season, so actual adjustments are usually in the ¬±7% to ¬±15% range.</em></p>

        <h4>B. Home/Away field advantage adjustments</h4>
        <p>After defensive adjustments, we apply home field advantage multipliers to account for location-based performance differences.</p>

        <p><strong>Why this matters:</strong> NFL data shows consistent home field advantage across all positions. Home teams score 2-4 more points per game on average. This stems from:</p>
        <ul>
          <li>Crowd noise disrupting opponent communication (helps your offense)</li>
          <li>Familiarity with field conditions, locker rooms, and routine</li>
          <li>Reduced travel fatigue and timezone changes</li>
          <li>Referee bias (subtle but measurable)</li>
        </ul>

        <p><strong>Implementation approach:</strong> We use evidence-based multipliers applied to player expectations (Œº) after defensive adjustments:</p>

        <table style="border-collapse: collapse; width: 100%; margin: 12px 0;">
          <thead>
            <tr style="border-bottom: 2px solid rgba(255,255,255,0.1);">
              <th style="text-align: left; padding: 8px;">Market</th>
              <th style="text-align: center; padding: 8px;">Home Multiplier</th>
              <th style="text-align: center; padding: 8px;">Away Multiplier</th>
              <th style="text-align: center; padding: 8px;">Total Spread</th>
            </tr>
          </thead>
          <tbody>
            <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
              <td style="padding: 8px;">Pass Yards</td>
              <td style="text-align: center; padding: 8px;">+6.0%</td>
              <td style="text-align: center; padding: 8px;">-6.0%</td>
              <td style="text-align: center; padding: 8px;"><strong>12.0%</strong></td>
            </tr>
            <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
              <td style="padding: 8px;">Pass TDs</td>
              <td style="text-align: center; padding: 8px;">+6.0%</td>
              <td style="text-align: center; padding: 8px;">-6.0%</td>
              <td style="text-align: center; padding: 8px;"><strong>12.0%</strong></td>
            </tr>
            <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
              <td style="padding: 8px;">Interceptions</td>
              <td style="text-align: center; padding: 8px;">-5.0%</td>
              <td style="text-align: center; padding: 8px;">+5.0%</td>
              <td style="text-align: center; padding: 8px;"><strong>10.0%</strong></td>
            </tr>
            <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
              <td style="padding: 8px;">Rush Yards</td>
              <td style="text-align: center; padding: 8px;">+4.0%</td>
              <td style="text-align: center; padding: 8px;">-4.0%</td>
              <td style="text-align: center; padding: 8px;"><strong>8.0%</strong></td>
            </tr>
            <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
              <td style="padding: 8px;">Rush Attempts</td>
              <td style="text-align: center; padding: 8px;">+2.0%</td>
              <td style="text-align: center; padding: 8px;">-2.0%</td>
              <td style="text-align: center; padding: 8px;"><strong>4.0%</strong></td>
            </tr>
            <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
              <td style="padding: 8px;">Receiving Yards</td>
              <td style="text-align: center; padding: 8px;">+6.0%</td>
              <td style="text-align: center; padding: 8px;">-6.0%</td>
              <td style="text-align: center; padding: 8px;"><strong>12.0%</strong></td>
            </tr>
            <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
              <td style="padding: 8px;">Receptions</td>
              <td style="text-align: center; padding: 8px;">+3.0%</td>
              <td style="text-align: center; padding: 8px;">-3.0%</td>
              <td style="text-align: center; padding: 8px;"><strong>6.0%</strong></td>
            </tr>
            <tr>
              <td style="padding: 8px;">Anytime TD</td>
              <td style="text-align: center; padding: 8px;">+5.0%</td>
              <td style="text-align: center; padding: 8px;">-5.0%</td>
              <td style="text-align: center; padding: 8px;"><strong>10.0%</strong></td>
            </tr>
          </tbody>
        </table>

        <h2 id="edge-nfl">4) Edge calculation &amp; consensus</h2>

        <h3>Converting probabilities to odds:</h3>
        <p>For each prop, we:</p>
        <ol>
          <li>Compute <strong>model probability</strong> of Over (e.g., <code>P(rush_yds ‚â• 50.5)</code>).</li>
          <li>Convert to <strong>fair odds</strong> via <code>fair_odds = round(100/p - 100)</code> for p ‚â• 50%, or <code>100√ó(1-p)/p</code> for p < 50%.</li>
          <li>Compare to sportsbook's American odds to compute basis-point edge.</li>
        </ol>

        <h3>Edge (basis points):</h3>
        <pre><code>edge_bps = 10000 √ó (model_prob - market_prob)</code></pre>
        <p>A positive edge means our model thinks the Over is more likely than the book's implied probability. Negative edge suggests the Under is favorable.</p>

        <h3>Consensus view:</h3>
        <p>When 3+ books offer the same player √ó market √ó side √ó line:</p>
        <ul>
          <li>We show the <strong>median price</strong> across books.</li>
          <li>Calculate consensus market probability from median odds.</li>
          <li>Highlight these props with a green background in the UI.</li>
        </ul>
        <p>Consensus props provide confidence that the line is well-established across the market, reducing the risk of stale or outlier pricing.</p>

        <h2 id="team-totals">5) Team Totals (Game Totals)</h2>

        <p>In addition to player props, we model NFL game totals by predicting each team's score independently and summing them.</p>

        <h3>Modeling approach:</h3>
        <ul>
          <li><strong>Ridge regression:</strong> L2-regularized linear model predicting individual team scores (not game totals).</li>
          <li><strong>Features:</strong> EPA-based team performance metrics over rolling windows (L3 and L5 games):
            <ul>
              <li>Offensive EPA per play, success rate, pass EPA, rush EPA</li>
              <li>Explosive play rate, third-down conversion rate, red-zone TD rate</li>
              <li>Defensive EPA per play, success rate</li>
              <li>Points scored and allowed (recent trends)</li>
            </ul>
          </li>
          <li><strong>Home field advantage:</strong> Built-in <code>is_home</code> indicator provides ~2.4 point boost for home teams.</li>
          <li><strong>Time series CV:</strong> 5-fold time series cross-validation preserving temporal order (MAE: ~7.6 points per team).</li>
        </ul>

        <h3>Why predict team scores separately:</h3>
        <p>Predicting each team's score individually (rather than the game total directly) allows us to:</p>
        <ul>
          <li>Apply home field advantage correctly (only to the home team)</li>
          <li>Show individual team predictions alongside the total</li>
          <li>Capture asymmetric matchups (e.g., strong offense vs weak defense)</li>
        </ul>

        <h3>Current implementation:</h3>
        <ul>
          <li><strong>Data source:</strong> Play-by-play data from nfl_data_py covering full 2024-2025 season (421 games, 72,808 plays).</li>
          <li><strong>Model performance:</strong> MAE of 7.64 points per team (RMSE: 9.67 points).</li>
          <li><strong>Predictions:</strong> Generated weekly for upcoming games, showing model total vs market consensus (when available).</li>
        </ul>

        <h3>Consensus edges:</h3>
        <p>When market data is available, we identify books offering lines that diverge from market consensus by ‚â•0.5 points, filtering for cases where our model agrees with the market (within 0.3 points). These represent opportunities to bet with the consensus before stale lines move.</p>

        <h2 id="limits">6) Known limitations</h2>
        <ul>
          <li><strong>Sample size:</strong> Early in the season (Weeks 1-4), we have limited data. Model confidence is lower.</li>
          <li><strong>Team context:</strong> We don't yet adjust for pace, game script, or team totals/spreads.</li>
          <li><strong>Weather:</strong> No weather adjustments (particularly important for passing games).</li>
          <li><strong>Venue effects:</strong> Dome vs outdoor conditions not yet factored.</li>
        </ul>

        <h2 id="roadmap">7) Roadmap</h2>
        <ul>
          <li>‚úÖ <strike>Exponential weighting for recent form</strike> (Oct 2024)</li>
          <li>‚úÖ <strike>L4 rolling window</strike> (Oct 2024)</li>
          <li>‚úÖ <strike>Injury/role adjustment framework</strike> (Oct 2024)</li>
          <li>‚úÖ <strike>Defensive matchup framework</strike> (Oct 2024)</li>
          <li>‚úÖ <strike>Family-based multi-market modeling</strike> (Oct 2024)</li>
          <li>‚úÖ <strike>Home/away field advantage adjustments</strike> (Oct 2024)</li>
          <li>üîÑ Team context (pace, pass rate, game totals)</li>
          <li>üîú Market fusion (weak Bayesian updates from consensus lines)</li>
          <li>üîú Monte Carlo joint simulation with correlated shocks</li>
          <li>üîú Weather and dome/outdoor venue adjustments</li>
        </ul>

        <hr />
        <p class="note">
          <strong>Why transparency matters:</strong> By documenting our methods, we hold ourselves accountable to users and enable informed decision-making. If you find issues with our projections or have suggestions for improvements, please reach out via <a href="https://x.com/fourthandvalue" target="_blank">@fourthandvalue</a> on X.
        </p>
      </div>

      <!-- NHL Tab Content -->
      <div id="nhl-tab" class="tab-content nhl-content">
        <div class="updated">Last updated: Oct 9, 2025</div>

        <p>This page describes how Fourth &amp; Value models NHL player props and calculates "value." Our approach leverages rolling game-by-game performance data and home/away adjustments to project player statistics.</p>

        <div class="highlight">
          <strong>üÜï Latest Update (Oct 9, 2025):</strong> NHL props now use rolling averages from the last 5 and 10 games (L5/L10) along with home/away splits to capture recent form and venue effects. Season-long stats provide additional context for player baseline performance.
        </div>

        <h2 id="what-we-model-nhl">1) What we model</h2>
        <p>We focus on four core NHL player-prop markets, normalized to canonical keys (<code>market_std</code>):</p>
        <ul>
          <li><strong>Poisson</strong>: <code>goals</code>, <code>assists</code>, <code>points</code> (goals + assists).</li>
          <li><strong>Normal/Gaussian</strong>: <code>sog</code> (shots on goal).</li>
        </ul>
        <p>We map sportsbook labels (e.g., "player_goals", "player_shots_on_goal") to these keys so we can merge and compare across books.</p>

        <h2 id="data-sources-nhl">2) Data sources (high level)</h2>
        <ul>
          <li><strong>Odds (per book):</strong> Player props and prices from multiple sportsbooks via The Odds API.</li>
          <li><strong>Player game logs:</strong> Game-by-game NHL skater stats including goals, assists, points, and shots on goal.</li>
          <li><strong>Schedule &amp; start times:</strong> Used for display (ET) and filtering upcoming games.</li>
          <li><strong>Venue information:</strong> Home/away designation for adjusting player performance based on game location.</li>
        </ul>

        <h2 id="modeling-nhl">3) Modeling approach</h2>

        <h3>Rolling averages with recency:</h3>
        <p>Per player √ó market, we compute rolling statistics from recent games:</p>

        <ul>
          <li><strong>Last 5 games (L5):</strong> Short-term form capturing recent hot/cold streaks.</li>
          <li><strong>Last 10 games (L10):</strong> Medium-term performance providing more stable baseline.</li>
          <li><strong>Season totals:</strong> Full season stats for broader context and regression to player baseline.</li>
        </ul>

        <p>These rolling windows are calculated separately for <strong>home</strong> and <strong>away</strong> games to capture venue-specific effects.</p>

        <h3>Core methodology:</h3>
        <ul>
          <li><strong>Poisson markets (goals, assists, points):</strong> Estimate rate <code>Œª</code> from rolling averages ‚Üí assume <em>Poisson(Œª)</em> distribution for counting events.</li>
          <li><strong>Normal markets (shots on goal):</strong> Estimate mean <code>Œº</code> and standard deviation <code>œÉ</code> from rolling data ‚Üí assume <em>Normal(Œº,œÉ)</em>.</li>
          <li><strong>Home/away adjustments:</strong> Model separately tracks performance at home vs. away venues, reflecting well-documented home-ice advantage effects.</li>
          <li><strong>Position awareness:</strong> Player position (L/C/D/R) is tracked to provide context for expected production patterns.</li>
        </ul>

        <h3>Why rolling averages?</h3>
        <p>NHL player performance varies significantly game-to-game due to factors like:</p>
        <ul>
          <li>Recent injury recovery or return from absence</li>
          <li>Line changes and ice-time adjustments</li>
          <li>Hot/cold shooting streaks</li>
          <li>Matchup-specific deployment</li>
        </ul>
        <p>L5 and L10 windows capture these short-term dynamics better than season-long averages alone. Combining multiple time horizons provides both recency bias and stability.</p>

        <h2 id="matchup-adjustments-nhl">4) Matchup adjustments</h2>

        <h3>Home/away venue effects:</h3>
        <p>We separately track player performance at home vs. away venues:</p>
        <ul>
          <li><strong>Home performance:</strong> Based on L5/L10 home games and season home splits.</li>
          <li><strong>Away performance:</strong> Based on L5/L10 away games and season away splits.</li>
        </ul>
        <p>This captures documented home-ice advantage effects including:</p>
        <ul>
          <li>Last line change advantage (favorable matchups)</li>
          <li>Crowd energy and familiarity</li>
          <li>Travel fatigue for road teams</li>
          <li>Typical 5-10% boost in home team performance metrics</li>
        </ul>

        <h3>Back-to-back considerations:</h3>
        <p>Our schedule data tracks whether teams are playing on consecutive nights (B2B):</p>
        <ul>
          <li><strong>First game of B2B:</strong> Generally normal performance expected.</li>
          <li><strong>Second game of B2B:</strong> Known fatigue effects, especially for goalies and defensemen with heavy ice time.</li>
        </ul>
        <p class="note"><em>Note: Future versions may explicitly adjust for B2B effects. Currently available as context in schedule data.</em></p>

        <h2 id="edge-calculation-nhl">5) Edge calculation &amp; consensus</h2>

        <h3>Converting probabilities to odds:</h3>
        <p>For each prop, we:</p>
        <ol>
          <li>Compute <strong>model probability</strong> of Over (e.g., <code>P(goals ‚â• 0.5)</code> for anytime goal scorer).</li>
          <li>Convert to <strong>fair odds</strong> via <code>fair_odds = round(100/p - 100)</code> for p ‚â• 50%, or <code>100√ó(1-p)/p</code> for p < 50%.</li>
          <li>Compare to sportsbook's American odds to compute basis-point edge.</li>
        </ol>

        <h3>Edge (basis points):</h3>
        <pre><code>edge_bps = 10000 √ó (model_prob - market_prob)</code></pre>
        <p>A positive edge means our model thinks the Over is more likely than the book's implied probability. Negative edge suggests the Under is favorable.</p>

        <h3>Consensus view:</h3>
        <p>When 3+ books offer the same player √ó market √ó side √ó line:</p>
        <ul>
          <li>We show the <strong>median price</strong> across books.</li>
          <li>Calculate consensus market probability from median odds.</li>
          <li>Highlight these props with a green background in the UI.</li>
        </ul>
        <p>Consensus props provide confidence that the line is well-established across the market, reducing the risk of stale or outlier pricing.</p>

        <h2 id="interpretation-nhl">6) Interpretation guide</h2>

        <h3>Edge magnitude:</h3>
        <ul>
          <li><strong>&lt; 200 bps:</strong> Marginal edge, within typical model noise and vig.</li>
          <li><strong>200-500 bps:</strong> Moderate edge, worth considering for action.</li>
          <li><strong>500-1000 bps:</strong> Strong edge, high-confidence model disagreement with market.</li>
          <li><strong>&gt; 1000 bps:</strong> Extreme edge, warrants investigation for stale lines or model issues.</li>
        </ul>

        <h3>Model confidence indicators:</h3>
        <ul>
          <li><strong>üî• Fire emoji (‚â•85% model prob):</strong> Very high confidence prediction.</li>
          <li><strong>Consensus highlighting:</strong> 3+ books agree on the line, suggesting market efficiency.</li>
          <li><strong>Games played:</strong> Players with more recent games have more reliable rolling averages.</li>
        </ul>

        <h3>What to watch out for:</h3>
        <ul>
          <li><strong>Limited sample sizes:</strong> Early season or players with few recent games may have unstable estimates.</li>
          <li><strong>Line movements:</strong> If a line moves significantly after our data snapshot, edge may be stale.</li>
          <li><strong>Injury news:</strong> Player availability changes can invalidate projections.</li>
          <li><strong>Lineup changes:</strong> Line combinations and ice time allocation affect opportunity.</li>
        </ul>

        <h2 id="nhl-totals">7) NHL Team Totals Modeling</h2>

        <div class="highlight">
          <strong>üÜï NEW (Nov 2025):</strong> NHL team totals predictions using player-level data aggregated to team features, with rolling windows, exponential weighting, opponent adjustments, and consensus edge detection for finding mispriced lines.
        </div>

        <h3>What we model:</h3>
        <p>Team total goals for each team in a game, which combines to predict the over/under line.</p>

        <h3>Data aggregation approach:</h3>
        <p><strong>Key insight:</strong> Instead of predicting individual player scores and averaging them (incorrect), we aggregate player statistics to team-level features FIRST, then predict team totals directly.</p>

        <p><strong>Team features from player data:</strong></p>
        <ul>
          <li><strong>Forwards (aggregated):</strong>
            <ul>
              <li>Total goals, assists, shots (sum across all forwards)</li>
              <li>Average goals per forward (mean)</li>
              <li>Top scorer production (max)</li>
              <li>Power play goals (sum)</li>
              <li>Face-off win percentage (mean)</li>
              <li>Takeaways, giveaways (sum)</li>
            </ul>
          </li>
          <li><strong>Defense (aggregated):</strong>
            <ul>
              <li>Total blocked shots (sum)</li>
              <li>Average plus/minus (mean)</li>
              <li>Hits, goals from defensemen (sum)</li>
            </ul>
          </li>
          <li><strong>Goalie (starting goalie only):</strong>
            <ul>
              <li>Save percentage</li>
              <li>Goals against</li>
              <li>Shots against</li>
            </ul>
          </li>
        </ul>

        <h3>Rolling windows & recency weighting:</h3>
        <p>For each team, we calculate rolling averages with exponential weighting:</p>
        <ul>
          <li><strong>Last 5 games (L5):</strong> Recent form and momentum</li>
          <li><strong>Last 10 games (L10):</strong> Medium-term performance baseline</li>
          <li><strong>Exponential weighted moving average (EWMA):</strong> Recent games weighted more heavily (span=5)</li>
        </ul>
        <p>Features include: <code>goals_l5</code>, <code>goals_l10</code>, <code>goals_ewm</code>, <code>shots_l5</code>, <code>pp_goals_l5</code>, <code>save_pct_l5</code>, etc.</p>

        <h3>Opponent strength adjustments:</h3>
        <p>We track opponent defensive metrics and incorporate them as features:</p>
        <ul>
          <li><strong>Opponent goals allowed per game:</strong> Rolling average of opponent's defensive performance</li>
          <li><strong>Opponent goalie save percentage:</strong> Starting goalie's recent form</li>
          <li><strong>Opponent blocked shots:</strong> Defensive activity level</li>
        </ul>

        <h3>Home/away splits:</h3>
        <p>Separately track team performance at home vs. away:</p>
        <ul>
          <li><code>home_avg_goals_for</code> - Team's scoring at home</li>
          <li><code>away_avg_goals_for</code> - Team's scoring on road</li>
          <li><code>is_home</code> - Binary indicator for current game location</li>
        </ul>

        <h3>Model training:</h3>
        <ul>
          <li><strong>Algorithm:</strong> Ridge regression (L2 regularization) for correlated features</li>
          <li><strong>Alternative models:</strong> Lasso, Elastic Net, Random Forest, Gradient Boosting available</li>
          <li><strong>Cross-validation:</strong> Time series CV with 5 folds (preserves temporal order, no data leakage)</li>
          <li><strong>Target variable:</strong> Team total goals in each game</li>
          <li><strong>Prediction:</strong> Home team total + Away team total = Game total (over/under)</li>
        </ul>

        <h3>Consensus edge detection:</h3>
        <p><strong>Strategy:</strong> Find books with lines out of sync with market consensus before they correct.</p>

        <p><strong>How it works:</strong></p>
        <ol>
          <li>Calculate <strong>market consensus line</strong> (mean across all books offering the total)</li>
          <li>Identify <strong>outlier books</strong> (lines differing from consensus by ‚â•0.5 goals)</li>
          <li>Check <strong>model agreement</strong> with consensus (within 0.3 goals)</li>
          <li>Flag plays where <strong>model + consensus agree</strong> but one book is off</li>
        </ol>

        <p><strong>Example:</strong></p>
        <ul>
          <li>Model prediction: 5.0 goals</li>
          <li>Market consensus: 5.0 goals (average across 8 books)</li>
          <li>Outlier book: 6.0 goals</li>
          <li><strong>Play:</strong> Bet Under 6.0 at outlier book before line moves to 5.0</li>
        </ul>

        <p>This is <strong>structural arbitrage on totals</strong> - betting on market inefficiency, not against the market.</p>

        <h3>Why this approach works:</h3>
        <ul>
          <li><strong>More data:</strong> Uses all player-level information (depth scoring, special teams, defense, goaltending)</li>
          <li><strong>Proper aggregation:</strong> Predicts at correct level (team totals, not averaged player predictions)</li>
          <li><strong>Captures dynamics:</strong> Rolling windows catch hot/cold streaks, recent role changes</li>
          <li><strong>Matchup aware:</strong> Opponent defensive strength directly affects predictions</li>
          <li><strong>Market timing:</strong> Consensus edges exploit morning lines before they sync</li>
        </ul>

        <h3>Performance metrics:</h3>
        <p>Model evaluated using time series cross-validation:</p>
        <ul>
          <li><strong>MAE (Mean Absolute Error):</strong> Average prediction error in goals</li>
          <li><strong>RMSE (Root Mean Squared Error):</strong> Prediction error with penalty for large misses</li>
          <li><strong>Typical performance:</strong> ~1.0-1.2 goal MAE on held-out test sets</li>
        </ul>

        <h2 id="limitations-nhl">8) Known limitations &amp; roadmap</h2>

        <h3>Player Props - Current limitations:</h3>
        <ul>
          <li><strong>No opponent adjustments:</strong> We don't yet account for opposing team's defensive strength (goals allowed, shots allowed rates).</li>
          <li><strong>No line-mate effects:</strong> Playing with elite centers/wingers significantly impacts production but isn't modeled.</li>
          <li><strong>No power-play modeling:</strong> Power-play opportunity and effectiveness not explicitly tracked.</li>
          <li><strong>No goalie matchup effects:</strong> Opposing goalie quality affects goal-scoring probabilities.</li>
          <li><strong>Basic B2B handling:</strong> Back-to-back fatigue effects known but not explicitly adjusted for.</li>
        </ul>

        <h3>Player Props - Planned improvements:</h3>
        <ul>
          <li><strong>Defensive matchup adjustments:</strong> Factor in opponent's goals-against and shots-against per game.</li>
          <li><strong>Power-play weighting:</strong> Separate PP and even-strength rates, weighted by expected PP time.</li>
          <li><strong>Goalie-aware projections:</strong> Adjust goal/assist rates based on starting goalie's save percentage.</li>
          <li><strong>Line-mate quality:</strong> Boost projections for players skating with elite offensive talent.</li>
          <li><strong>B2B fatigue multipliers:</strong> Explicit downward adjustments for second game of back-to-backs.</li>
          <li><strong>Time-on-ice (TOI) tracking:</strong> Weight projections by expected ice time rather than just game-by-game stats.</li>
        </ul>

        <h3>Team Totals - Future enhancements:</h3>
        <ul>
          <li><strong>Advanced metrics:</strong> Incorporate Corsi, Fenwick, expected goals (xG) from shot quality</li>
          <li><strong>Line combinations:</strong> Track top-line vs depth production separately</li>
          <li><strong>Rest days:</strong> Explicit adjustments for back-to-back games</li>
          <li><strong>Venue effects:</strong> Different home ice advantages by arena</li>
          <li><strong>Market fusion:</strong> Bayesian updates incorporating sharp money movement</li>
        </ul>

        <hr />
        <p class="note">
          <strong>Why transparency matters:</strong> By documenting our methods, we hold ourselves accountable to users and enable informed decision-making. If you find issues with our projections or have suggestions for improvements, please reach out via <a href="https://x.com/fourthandvalue" target="_blank">@fourthandvalue</a> on X.
        </p>

        <p class="note">
          <strong>Reminder:</strong> Sports betting involves risk. Our models provide information and analysis, not guarantees. Always bet responsibly and within your means.
        </p>
      </div>
    </div>
  </main>

  <script>
    // Tab switching functionality
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabContents = document.querySelectorAll('.tab-content');

    tabButtons.forEach(button => {
      button.addEventListener('click', () => {
        const targetTab = button.getAttribute('data-tab');

        // Remove active class from all buttons and contents
        tabButtons.forEach(btn => btn.classList.remove('active'));
        tabContents.forEach(content => content.classList.remove('active'));

        // Add active class to clicked button and corresponding content
        button.classList.add('active');
        document.getElementById(`${targetTab}-tab`).classList.add('active');
      });
    });
  </script>
</body>
</html>
