<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Fourth & Value — Methods</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark light" />
  <style>
    :root { --bg:#0f1418; --text:#e5e7eb; --muted:#9aa4af; --card:#131a20; --accent:#cbd5e1; }
    html,body { margin:0; padding:0; background:var(--bg); color:var(--text); font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial; }
    a { color:var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }
    .wrap { max-width: 980px; margin: 48px auto; padding: 0 20px; }
    .card { background:var(--card); border-radius:16px; padding:24px; box-shadow: 0 4px 16px rgba(0,0,0,.25); }
    h1 { font-size: 2rem; margin: 0 0 8px; }
    h2 { font-size: 1.25rem; margin: 28px 0 8px; }
    h3 { font-size: 1.05rem; margin: 20px 0 6px; }
    .updated { color: var(--muted); font-size: 0.95rem; margin-bottom: 18px; }
    ul { margin: 8px 0 8px 1.25rem; }
    code { background: rgba(255,255,255,0.06); padding: 2px 6px; border-radius: 6px; }
    .note { color: var(--muted); font-size: 0.95rem; }
    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; font-size: .95em; }
    hr { border: 0; border-top: 1px solid rgba(255,255,255,.08); margin: 28px 0; }
    .highlight { background: rgba(59, 130, 246, 0.1); border-left: 3px solid #3b82f6; padding: 12px; margin: 12px 0; border-radius: 4px; }
  </style>
</head>
<body>
  <div id="nav-root"></div>
  <script src="./nav.js?v=6"></script>

  <main class="wrap">
    <div class="card">
      <h1>Methods</h1>
      <div class="updated">Last updated: Oct 8, 2025</div>

      <p>This page describes how Fourth &amp; Value models player props and calculates "value." It's intentionally general (no week-specific numbers) so it stays accurate as we update models.</p>

      <div class="highlight">
        <strong>🆕 Latest Update (Oct 8, 2025):</strong> Home/away field advantage adjustments are now live! We apply evidence-based multipliers (±3% to ±6%) based on game location, resulting in 6-12% spreads between home and away projections. Combined with defensive adjustments, this brings our model significantly closer to market consensus. See the Matchup Adjustments section for full details.
      </div>

      <h2 id="what-we-model">1) What we model</h2>
      <p>We focus on common player-prop markets, normalized to canonical keys (<code>market_std</code>):</p>
      <ul>
        <li><strong>Normal/Gaussian</strong>: <code>rush_yds</code>, <code>recv_yds</code>, <code>pass_yds</code>, <code>receptions</code>, <code>rush_attempts</code>, <code>pass_attempts</code>, <code>pass_completions</code>.</li>
        <li><strong>Poisson</strong>: <code>anytime_td</code>, <code>pass_tds</code>, <code>pass_interceptions</code>.</li>
      </ul>
      <p>We map sportsbook labels (e.g., "player_rushing_yards") to these keys so we can merge and compare across books.</p>

      <h2 id="data-sources">2) Data sources (high level)</h2>
      <ul>
        <li><strong>Odds (per book):</strong> Player props and prices from multiple sportsbooks via The Odds API.</li>
        <li><strong>Player game logs:</strong> Weekly player stats from nflverse (official NFL data).</li>
        <li><strong>Schedule &amp; kickoff:</strong> Used for display (ET) and filtering upcoming games.</li>
        <li><strong>Defensive stats:</strong> Computed from opponent performance (yards allowed per game).</li>
      </ul>

      <h2 id="modeling">3) Modeling approach</h2>

      <h3>Family-based multi-market modeling (Oct 2024):</h3>
      <p>Instead of modeling each market independently, we now model <strong>linked market families</strong> through shared latent factors:</p>

      <ul>
        <li><strong>Rush family:</strong> <code>rush_attempts</code> and <code>rush_yds</code> are linked through:
          <ul>
            <li>Volume latent: expected carries (μ, σ)</li>
            <li>Efficiency latent: yards per carry (μ, σ) bounded [2.5, 6.5]</li>
            <li>Derived relationship: <code>rush_yds = rush_attempts × YPC</code></li>
          </ul>
        </li>
        <li><strong>Receive family:</strong> <code>receptions</code> and <code>recv_yds</code> linked through:
          <ul>
            <li>Volume latent: expected targets</li>
            <li>Catch rate: receptions/targets bounded [0.50, 0.95]</li>
            <li>Yards per reception: bounded [6.0, 18.0]</li>
            <li>Derived: <code>recv_yds = targets × catch_rate × YPR</code></li>
          </ul>
        </li>
        <li><strong>Pass family:</strong> <code>pass_attempts</code>, <code>pass_completions</code>, and <code>pass_yds</code> linked through:
          <ul>
            <li>Volume latent: expected attempts</li>
            <li>Completion percentage: bounded [0.50, 0.75]</li>
            <li>Yards per completion: bounded [5.0, 12.0]</li>
            <li>Derived: <code>pass_yds = attempts × comp% × Y/C</code></li>
          </ul>
        </li>
      </ul>

      <p><strong>Why this matters:</strong> When a sportsbook moves the rush attempts line but not rush yards, our model detects the implied efficiency change. If a book prices 18 carries at 120 yards (6.67 YPC—above our max bound), we know they're mispricing at least one market. This surfaces arbitrage opportunities where both linked markets show value.</p>

      <h3>Core methodology:</h3>
      <ul>
        <li><strong>Recency-weighted L4:</strong> Per player × market, we use only the <strong>last 4 games</strong> (L4) with <strong>exponential weighting</strong> (alpha=0.4). Most recent game receives ~64% of the total weight.</li>
        <li><strong>Normal markets:</strong> Estimate mean <code>μ</code> and standard deviation <code>σ</code> → assume <em>Normal(μ,σ)</em>.</li>
        <li><strong>Poisson markets:</strong> Estimate rate <code>λ</code> for counts (TDs, INTs) → assume <em>Poisson(λ)</em>.</li>
        <li><strong>Sanity guards:</strong> Efficiency metrics are bounded to realistic ranges; floor <code>σ</code> to avoid overconfidence.</li>
      </ul>

      <h3>Exponential weighting:</h3>
      <p>Recent games receive exponentially more weight than older games. For a 4-game window:</p>
      <ul>
        <li>Oldest game (Week N-3): <strong>10.3%</strong> weight</li>
        <li>2nd oldest (Week N-2): <strong>25.6%</strong> weight</li>
        <li>Most recent (Week N-1): <strong>64.1%</strong> weight</li>
      </ul>
      <p>This captures form changes, hot streaks, and role adjustments much faster than simple averages.</p>

      <h3>Matchup adjustments:</h3>
      <p>We apply two layers of matchup adjustments to account for both opponent strength and game location:</p>

      <h4>A. Defensive adjustments</h4>
      <p>Player projections are adjusted based on opponent defensive strength.</p>

      <p><strong>Defensive rating calculation:</strong></p>
      <ul>
        <li>Computed from <strong>current season yards allowed per game</strong> (weeks 1 to N-1)</li>
        <li>Normalized using z-scores to a <strong>0.5–2.0 scale</strong>:
          <ul>
            <li>0.5 = Easiest defense (most yards allowed)</li>
            <li>1.0 = League average defense</li>
            <li>2.0 = Toughest defense (fewest yards allowed)</li>
          </ul>
        </li>
        <li>Separate ratings for pass defense and rush defense</li>
        <li>Updated weekly as more games are played</li>
      </ul>

      <p><strong>Adjustment formula:</strong></p>
      <ul>
        <li><code>adjustment_factor = 1.0 - (def_rating - 1.0) × 0.3</code></li>
        <li>Applied to μ after deriving from latent factors: <code>μ_adjusted = μ × adjustment_factor</code></li>
        <li>Market mapping:
          <ul>
            <li>Receptions, receiving yards: use <strong>pass_def_rating</strong></li>
            <li>Rush yards, rush attempts: use <strong>rush_def_rating</strong></li>
            <li>QB passing markets: use <strong>pass_def_rating</strong></li>
          </ul>
        </li>
      </ul>

      <p><strong>Examples:</strong></p>
      <ul>
        <li>Easiest defense (0.5 rating) → <code>1.0 - (0.5 - 1.0) × 0.3 = 1.15</code> → <strong>+15% boost</strong></li>
        <li>Average defense (1.0 rating) → <code>1.0 - (1.0 - 1.0) × 0.3 = 1.00</code> → <strong>No change</strong></li>
        <li>Tough defense (1.5 rating) → <code>1.0 - (1.5 - 1.0) × 0.3 = 0.85</code> → <strong>-15% penalty</strong></li>
      </ul>

      <p class="note"><em>Note: In practice, defensive ratings typically range from 0.5 to ~1.5 early in the season, so actual adjustments are usually in the ±7% to ±15% range.</em></p>

      <h4>B. Home/Away field advantage adjustments</h4>
      <p>After defensive adjustments, we apply home field advantage multipliers to account for location-based performance differences.</p>

      <p><strong>Why this matters:</strong> NFL data shows consistent home field advantage across all positions. Home teams score 2-4 more points per game on average. This stems from:</p>
      <ul>
        <li>Crowd noise disrupting opponent communication (helps your offense)</li>
        <li>Familiarity with field conditions, locker rooms, and routine</li>
        <li>Reduced travel fatigue and timezone changes</li>
        <li>Referee bias (subtle but measurable)</li>
      </ul>

      <p><strong>Implementation approach:</strong> We use evidence-based multipliers applied to player expectations (μ) after defensive adjustments:</p>

      <table style="border-collapse: collapse; width: 100%; margin: 12px 0;">
        <thead>
          <tr style="border-bottom: 2px solid rgba(255,255,255,0.1);">
            <th style="text-align: left; padding: 8px;">Market</th>
            <th style="text-align: center; padding: 8px;">Home Multiplier</th>
            <th style="text-align: center; padding: 8px;">Away Multiplier</th>
            <th style="text-align: center; padding: 8px;">Total Spread</th>
          </tr>
        </thead>
        <tbody>
          <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
            <td style="padding: 8px;">Pass Yards</td>
            <td style="text-align: center; padding: 8px;">+6.0%</td>
            <td style="text-align: center; padding: 8px;">-6.0%</td>
            <td style="text-align: center; padding: 8px;"><strong>12.0%</strong></td>
          </tr>
          <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
            <td style="padding: 8px;">Pass TDs</td>
            <td style="text-align: center; padding: 8px;">+6.0%</td>
            <td style="text-align: center; padding: 8px;">-6.0%</td>
            <td style="text-align: center; padding: 8px;"><strong>12.0%</strong></td>
          </tr>
          <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
            <td style="padding: 8px;">Interceptions</td>
            <td style="text-align: center; padding: 8px;">-5.0%</td>
            <td style="text-align: center; padding: 8px;">+5.0%</td>
            <td style="text-align: center; padding: 8px;"><strong>10.0%</strong></td>
          </tr>
          <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
            <td style="padding: 8px;">Rush Yards</td>
            <td style="text-align: center; padding: 8px;">+4.0%</td>
            <td style="text-align: center; padding: 8px;">-4.0%</td>
            <td style="text-align: center; padding: 8px;"><strong>8.0%</strong></td>
          </tr>
          <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
            <td style="padding: 8px;">Rush Attempts</td>
            <td style="text-align: center; padding: 8px;">+2.0%</td>
            <td style="text-align: center; padding: 8px;">-2.0%</td>
            <td style="text-align: center; padding: 8px;"><strong>4.0%</strong></td>
          </tr>
          <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
            <td style="padding: 8px;">Receiving Yards</td>
            <td style="text-align: center; padding: 8px;">+6.0%</td>
            <td style="text-align: center; padding: 8px;">-6.0%</td>
            <td style="text-align: center; padding: 8px;"><strong>12.0%</strong></td>
          </tr>
          <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
            <td style="padding: 8px;">Receptions</td>
            <td style="text-align: center; padding: 8px;">+3.0%</td>
            <td style="text-align: center; padding: 8px;">-3.0%</td>
            <td style="text-align: center; padding: 8px;"><strong>6.0%</strong></td>
          </tr>
          <tr>
            <td style="padding: 8px;">Anytime TD</td>
            <td style="text-align: center; padding: 8px;">+5.0%</td>
            <td style="text-align: center; padding: 8px;">-5.0%</td>
            <td style="text-align: center; padding: 8px;"><strong>10.0%</strong></td>
          </tr>
        </tbody>
      </table>

      <p><strong>Real-world impact (Week 6 data):</strong></p>
      <ul>
        <li><strong>Coverage:</strong> 80.5% of props (206/256) have home/away data
          <ul>
            <li>Missing data primarily from D/ST units and recently traded players</li>
          </ul>
        </li>
        <li><strong>Passing yards:</strong> Home QBs average 152.1 yards vs 134.6 away (+13.1% actual difference)</li>
        <li><strong>Receiving yards:</strong> Home WRs/TEs average 42.0 yards vs 36.6 away (+14.8%)</li>
        <li><strong>Rush yards:</strong> Home RBs average 54.4 yards vs 50.8 away (+6.9%)</li>
      </ul>

      <p><strong>Data pipeline:</strong></p>
      <ol>
        <li>Fetch NFL schedule data (home_team/away_team for each game)</li>
        <li>Enrich historical game logs with <code>is_home</code> flag by joining on team/opponent/week</li>
        <li>Build player params from L4 weighted history</li>
        <li>Apply defensive adjustments (opponent strength)</li>
        <li>Apply home/away multipliers (game location) ← <strong>New step</strong></li>
        <li>Generate final probabilities for O/U props</li>
      </ol>

      <p><strong>Why simple multipliers (vs full home/away splits)?</strong></p>
      <ul>
        <li>✅ Requires less historical data (4 games vs 8+ for statistical significance)</li>
        <li>✅ Lower risk of overfitting early in the season</li>
        <li>✅ Easier to tune and validate against backtest results</li>
        <li>✅ More transparent for users</li>
        <li>🔜 Future phase: Full home/away distribution splits when we have sufficient data</li>
      </ul>

      <p class="note"><em>Note: Home/away adjustments are applied multiplicatively after defensive adjustments. A player facing a tough defense on the road receives both penalties (e.g., -15% defensive × -6% away = -20.1% total).</em></p>

      <h3>Manual adjustments (injuries/role changes):</h3>
      <ul>
        <li><strong>Config-driven overrides:</strong> We maintain a JSON configuration for known injuries, suspensions, or role changes.</li>
        <li><strong>Multiplier system:</strong> Adjust player μ by any factor (0.0 = out, 0.5-0.8 = limited, 1.0+ = increased role).</li>
        <li><strong>Transparency:</strong> All adjustments logged with reason codes.</li>
      </ul>

      <h2 id="probabilities">4) From parameters to probabilities</h2>
      <ul>
        <li><strong>Normal O/U:</strong> Over uses <code>P(X &gt; L)</code>; Under uses <code>P(X &lt; L)</code> where <code>X ~ Normal(μ,σ)</code> and <code>L</code> is the book's line.</li>
        <li><strong>Poisson:</strong> "Yes" (e.g., anytime TD) uses <code>P(X ≥ 1) = 1 − e^{−λ}</code>; thresholds use the Poisson CDF.</li>
        <li><strong>Model line (display):</strong> For Normal markets we show μ (mean) as our model line; for Poisson we show median.</li>
      </ul>

      <h2 id="edge">5) Prices, consensus, and "value"</h2>
      <ul>
        <li><strong>Book-implied probability:</strong> Convert American odds → implied probability for each book row.</li>
        <li><strong>De-vig factor:</strong> We apply a 0.9524 factor (~5% vig removal) to get fair market probability.</li>
        <li><strong>Edge (bps):</strong> <code>(model_prob − devigged_market_prob) × 10,000</code> (1% = 100 bps). Primary ranking signal.</li>
        <li><strong>Fair odds:</strong> Invert <code>model_prob</code> to a no-vig "fair" price for quick comparison.</li>
        <li><strong>Consensus:</strong> Aggregate de-vigged probabilities across books by <code>(name_std, market_std, side)</code>. Consensus line = median across all books.</li>
      </ul>

      <h2 id="directional-filter">6) Directional alignment filter (Consensus page)</h2>
      <p>On the Consensus page, we only show bets where the <strong>model, consensus, and book all agree on direction</strong>:</p>
      <ul>
        <li><strong>For OVER bets:</strong> Book line &lt; Consensus line &lt; Model line (all lean over)</li>
        <li><strong>For UNDER bets:</strong> Book line &gt; Consensus line &gt; Model line (all lean under)</li>
      </ul>
      <p>This filters for high-conviction signals where multiple data sources agree.</p>

      <h2 id="family-opportunities">7) Family-based opportunity detection</h2>
      <p>Our family modeling enables three types of edge detection that traditional independent-market models miss:</p>

      <h3>A. Family arbitrage (high-conviction plays):</h3>
      <p>When <strong>both</strong> linked markets show strong edge in the same direction, we flag it as a family arbitrage opportunity. Example from Week 5:</p>
      <ul>
        <li><strong>James Cook (Rush family):</strong>
          <ul>
            <li>Rush attempts Over: +5,073 bps edge</li>
            <li>Rush yards Over: +5,228 bps edge</li>
            <li><strong>Combined: +10,301 bps</strong> (volume AND efficiency both point up)</li>
          </ul>
        </li>
      </ul>
      <p>These are higher-conviction bets because the edge isn't coming from a single market quirk—both volume and efficiency projections align.</p>

      <h3>B. Incoherent book lines:</h3>
      <p>When a sportsbook's lines imply physically impossible or highly unlikely efficiency metrics, we flag them:</p>
      <ul>
        <li><strong>Cam Ward (Bovada):</strong> 3.5 attempts → 4.5 yards = <strong>1.29 YPC</strong>
          <ul><li>NFL minimum realistic YPC is ~2.5. This line is incoherent.</li></ul>
        </li>
        <li><strong>Chase Brown (BetRivers):</strong> 5.5 receptions → 20.5 yards = <strong>3.73 YPR</strong>
          <ul><li>Realistic YPR bounds are 6–18. This implies impossible inefficiency.</li></ul>
        </li>
      </ul>
      <p>When books are incoherent, there's often value on <em>both</em> sides of the linked markets (e.g., Over on attempts, Under on yards).</p>

      <h3>C. Model coherence validation:</h3>
      <p>We continuously validate that our own projections stay within realistic bounds:</p>
      <ul>
        <li>YPC: [2.5, 6.5] yards per carry</li>
        <li>YPR: [6.0, 18.0] yards per reception</li>
        <li>Comp%: [50%, 75%] completion percentage</li>
        <li>Y/C: [5.0, 12.0] yards per completion (QB)</li>
      </ul>
      <p>Week 5 result: <strong>0 violations</strong>—all 100+ player projections fell within bounds.</p>

      <h3>Real-world impact (Week 5):</h3>
      <ul>
        <li><strong>2,277 family arbitrage opportunities</strong> detected across Rush/Receive/Pass families</li>
        <li><strong>51 incoherent book lines</strong> flagged (most at BetRivers, Bovada, DraftKings)</li>
        <li>Top combined edge: <strong>Zay Jones</strong> receptions + yards on Bovada = +12,056 bps</li>
      </ul>

      <h2 id="display">8) What you see on the site</h2>
      <ul>
        <li><strong>Props:</strong> Per-book rows with Model %, Market %, Edge (bps), Fair Odds, Consensus data. Filter by game, market, player, and books you have access to.</li>
        <li><strong>Top Picks:</strong> One card per player × market × side; ranked by edge. Shows best available book/price with copy-bet functionality.</li>
        <li><strong>Consensus:</strong> Filtered for directional alignment. Shows model vs book vs consensus with multi-book aggregation.</li>
      </ul>

      <h2 id="example">9) Real example: How the model behaves</h2>
      <p><strong>Player:</strong> DeMario Douglas, Receptions, Over 1.5</p>
      <p><strong>Recent games (2024 Weeks 1-3):</strong> 2, 1, 2 receptions</p>

      <p><strong>Old model (simple average):</strong></p>
      <ul>
        <li>μ = (2 + 1 + 2) / 3 = <strong>1.67 receptions</strong></li>
        <li>P(Over 1.5) = <strong>61.4%</strong></li>
      </ul>

      <p><strong>New model (L4 exponential weighted):</strong></p>
      <ul>
        <li>μ = 2×10.3% + 1×25.6% + 2×64.1% = <strong>1.74 receptions</strong></li>
        <li>P(Over 1.5) = <strong>71.2%</strong></li>
      </ul>

      <p>The most recent game (2 receptions) gets 64% weight, pulling the expectation up and increasing our model's confidence in the Over.</p>

      <h2 id="limits">10) Known limitations</h2>
      <ul>
        <li><strong>Sample size:</strong> Early in the season (Weeks 1-4), we have limited data. Model confidence is lower.</li>
        <li><strong>Team context:</strong> We don't yet adjust for pace, game script, or team totals/spreads.</li>
        <li><strong>Weather:</strong> No weather adjustments (particularly important for passing games).</li>
        <li><strong>Venue effects:</strong> Dome vs outdoor conditions not yet factored.</li>
      </ul>

      <h2 id="roadmap">11) Roadmap</h2>
      <ul>
        <li>✅ <strike>Exponential weighting for recent form</strike> (Oct 2024)</li>
        <li>✅ <strike>L4 rolling window</strike> (Oct 2024)</li>
        <li>✅ <strike>Injury/role adjustment framework</strike> (Oct 2024)</li>
        <li>✅ <strike>Defensive matchup framework</strike> (Oct 2024)</li>
        <li>✅ <strike>Family-based multi-market modeling</strike> (Oct 2024)</li>
        <li>✅ <strike>Coherence validation &amp; opportunity detection</strike> (Oct 2024)</li>
        <li>✅ <strike>Defensive stats integrated into production</strike> (Oct 2024)</li>
        <li>✅ <strike>Home/away field advantage adjustments</strike> (Oct 2024)</li>
        <li>🔄 Team context (pace, pass rate, game totals)</li>
        <li>🔜 Market fusion (weak Bayesian updates from consensus lines)</li>
        <li>🔜 Monte Carlo joint simulation with correlated shocks</li>
        <li>🔜 Usage-based priors (target share, routes, red-zone touches)</li>
        <li>🔜 Weather and dome/outdoor venue adjustments</li>
        <li>🔜 Systematic calibration tracking (Brier scores, log loss)</li>
        <li>🔜 Public post-game grading and calibration charts</li>
        <li>🔜 Expanded markets (alt lines, first/last TD)</li>
      </ul>

      <hr />
      <p class="note">Questions or suggestions? Find us on GitHub or reach out via the site. We're continuously improving the model and always open to feedback from sharp bettors.</p>
    </div>
  </main>
</body>
</html>
