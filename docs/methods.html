<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Fourth & Value â€” Methods</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark light" />
  <style>
    :root { --bg:#0f1418; --text:#e5e7eb; --muted:#9aa4af; --card:#131a20; --accent:#cbd5e1; }
    html,body { margin:0; padding:0; background:var(--bg); color:var(--text); font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial; }
    a { color:var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }
    .wrap { max-width: 980px; margin: 48px auto; padding: 0 20px; }
    .card { background:var(--card); border-radius:16px; padding:24px; box-shadow: 0 4px 16px rgba(0,0,0,.25); }
    h1 { font-size: 2rem; margin: 0 0 8px; }
    h2 { font-size: 1.25rem; margin: 28px 0 8px; }
    h3 { font-size: 1.05rem; margin: 20px 0 6px; }
    .updated { color: var(--muted); font-size: 0.95rem; margin-bottom: 18px; }
    ul { margin: 8px 0 8px 1.25rem; }
    code { background: rgba(255,255,255,0.06); padding: 2px 6px; border-radius: 6px; }
    .note { color: var(--muted); font-size: 0.95rem; }
    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; font-size: .95em; }
    hr { border: 0; border-top: 1px solid rgba(255,255,255,.08); margin: 28px 0; }
    .highlight { background: rgba(59, 130, 246, 0.1); border-left: 3px solid #3b82f6; padding: 12px; margin: 12px 0; border-radius: 4px; }
  </style>
</head>
<body>
  <div id="nav-root"></div>
  <script src="./nav.js?v=6"></script>

  <main class="wrap">
    <div class="card">
      <h1>Methods</h1>
      <div class="updated">Last updated: Oct 5, 2024</div>

      <p>This page describes how Fourth &amp; Value models player props and calculates "value." It's intentionally general (no week-specific numbers) so it stays accurate as we update models.</p>

      <h2 id="what-we-model">1) What we model</h2>
      <p>We focus on common player-prop markets, normalized to canonical keys (<code>market_std</code>):</p>
      <ul>
        <li><strong>Normal/Gaussian</strong>: <code>rush_yds</code>, <code>recv_yds</code>, <code>pass_yds</code>, <code>receptions</code>, <code>rush_attempts</code>, <code>pass_attempts</code>, <code>pass_completions</code>.</li>
        <li><strong>Poisson</strong>: <code>anytime_td</code>, <code>pass_tds</code>, <code>pass_interceptions</code>.</li>
      </ul>
      <p>We map sportsbook labels (e.g., "player_rushing_yards") to these keys so we can merge and compare across books.</p>

      <h2 id="data-sources">2) Data sources (high level)</h2>
      <ul>
        <li><strong>Odds (per book):</strong> Player props and prices from multiple sportsbooks via The Odds API.</li>
        <li><strong>Player game logs:</strong> Weekly player stats from nflverse (official NFL data).</li>
        <li><strong>Schedule &amp; kickoff:</strong> Used for display (ET) and filtering upcoming games.</li>
        <li><strong>Defensive stats:</strong> Computed from opponent performance (yards allowed per game).</li>
      </ul>

      <h2 id="modeling">3) Modeling approach</h2>

      <div class="highlight">
        <strong>ðŸ†• Recent Updates (Oct 2024):</strong> We've significantly enhanced the model with exponential weighting, rolling windows, and matchup adjustments. See details below.
      </div>

      <h3>Core methodology:</h3>
      <ul>
        <li><strong>Recency-weighted L4:</strong> Per player Ã— market, we use only the <strong>last 4 games</strong> (L4) with <strong>exponential weighting</strong> (alpha=0.4). Most recent game receives ~64% of the total weight.</li>
        <li><strong>Normal markets:</strong> Estimate mean <code>Î¼</code> and standard deviation <code>Ïƒ</code> â†’ assume <em>Normal(Î¼,Ïƒ)</em>.</li>
        <li><strong>Poisson markets:</strong> Estimate rate <code>Î»</code> for counts (TDs, INTs) â†’ assume <em>Poisson(Î»)</em>.</li>
        <li><strong>Sanity guards:</strong> Floor <code>Ïƒ</code> to avoid overconfidence; clamp <code>Î¼ â‰¥ 0</code> on yardage/attempt stats.</li>
      </ul>

      <h3>Exponential weighting:</h3>
      <p>Recent games receive exponentially more weight than older games. For a 4-game window:</p>
      <ul>
        <li>Oldest game (Week N-3): <strong>10.3%</strong> weight</li>
        <li>2nd oldest (Week N-2): <strong>25.6%</strong> weight</li>
        <li>Most recent (Week N-1): <strong>64.1%</strong> weight</li>
      </ul>
      <p>This captures form changes, hot streaks, and role adjustments much faster than simple averages.</p>

      <h3>Matchup adjustments:</h3>
      <ul>
        <li><strong>Opponent defensive strength:</strong> We compute defensive ratings (0.5-2.0 scale) based on yards allowed per game.</li>
        <li><strong>Adjustment range:</strong> Â±15% to player expectations
          <ul>
            <li>Weakest defense (0.5 rating): +15% boost to Î¼</li>
            <li>Average defense (1.0 rating): No adjustment</li>
            <li>Toughest defense (2.0 rating): -15% penalty to Î¼</li>
          </ul>
        </li>
      </ul>

      <h3>Manual adjustments (injuries/role changes):</h3>
      <ul>
        <li><strong>Config-driven overrides:</strong> We maintain a JSON configuration for known injuries, suspensions, or role changes.</li>
        <li><strong>Multiplier system:</strong> Adjust player Î¼ by any factor (0.0 = out, 0.5-0.8 = limited, 1.0+ = increased role).</li>
        <li><strong>Transparency:</strong> All adjustments logged with reason codes.</li>
      </ul>

      <h2 id="probabilities">4) From parameters to probabilities</h2>
      <ul>
        <li><strong>Normal O/U:</strong> Over uses <code>P(X &gt; L)</code>; Under uses <code>P(X &lt; L)</code> where <code>X ~ Normal(Î¼,Ïƒ)</code> and <code>L</code> is the book's line.</li>
        <li><strong>Poisson:</strong> "Yes" (e.g., anytime TD) uses <code>P(X â‰¥ 1) = 1 âˆ’ e^{âˆ’Î»}</code>; thresholds use the Poisson CDF.</li>
        <li><strong>Model line (display):</strong> For Normal markets we show Î¼ (mean) as our model line; for Poisson we show median.</li>
      </ul>

      <h2 id="edge">5) Prices, consensus, and "value"</h2>
      <ul>
        <li><strong>Book-implied probability:</strong> Convert American odds â†’ implied probability for each book row.</li>
        <li><strong>De-vig factor:</strong> We apply a 0.9524 factor (~5% vig removal) to get fair market probability.</li>
        <li><strong>Edge (bps):</strong> <code>(model_prob âˆ’ devigged_market_prob) Ã— 10,000</code> (1% = 100 bps). Primary ranking signal.</li>
        <li><strong>Fair odds:</strong> Invert <code>model_prob</code> to a no-vig "fair" price for quick comparison.</li>
        <li><strong>Consensus:</strong> Aggregate de-vigged probabilities across books by <code>(name_std, market_std, side)</code>. Consensus line = median across all books.</li>
      </ul>

      <h2 id="directional-filter">6) Directional alignment filter (Consensus page)</h2>
      <p>On the Consensus page, we only show bets where the <strong>model, consensus, and book all agree on direction</strong>:</p>
      <ul>
        <li><strong>For OVER bets:</strong> Book line &lt; Consensus line &lt; Model line (all lean over)</li>
        <li><strong>For UNDER bets:</strong> Book line &gt; Consensus line &gt; Model line (all lean under)</li>
      </ul>
      <p>This filters for high-conviction signals where multiple data sources agree.</p>

      <h2 id="display">7) What you see on the site</h2>
      <ul>
        <li><strong>Props:</strong> Per-book rows with Model %, Market %, Edge (bps), Fair Odds, Consensus data. Filter by game, market, player, and books you have access to.</li>
        <li><strong>Top Picks:</strong> One card per player Ã— market Ã— side; ranked by edge. Shows best available book/price with copy-bet functionality.</li>
        <li><strong>Consensus:</strong> Filtered for directional alignment. Shows model vs book vs consensus with multi-book aggregation.</li>
      </ul>

      <h2 id="example">8) Real example: How the model behaves</h2>
      <p><strong>Player:</strong> DeMario Douglas, Receptions, Over 1.5</p>
      <p><strong>Recent games (2024 Weeks 1-3):</strong> 2, 1, 2 receptions</p>

      <p><strong>Old model (simple average):</strong></p>
      <ul>
        <li>Î¼ = (2 + 1 + 2) / 3 = <strong>1.67 receptions</strong></li>
        <li>P(Over 1.5) = <strong>61.4%</strong></li>
      </ul>

      <p><strong>New model (L4 exponential weighted):</strong></p>
      <ul>
        <li>Î¼ = 2Ã—10.3% + 1Ã—25.6% + 2Ã—64.1% = <strong>1.74 receptions</strong></li>
        <li>P(Over 1.5) = <strong>71.2%</strong></li>
      </ul>

      <p>The most recent game (2 receptions) gets 64% weight, pulling the expectation up and increasing our model's confidence in the Over.</p>

      <h2 id="limits">9) Known limitations</h2>
      <ul>
        <li><strong>Sample size:</strong> Early in the season (Weeks 1-4), we have limited data. Model confidence is lower.</li>
        <li><strong>Defensive adjustments:</strong> Framework built but not yet fully integrated into production.</li>
        <li><strong>Team context:</strong> We don't yet adjust for pace, game script, or team totals/spreads.</li>
        <li><strong>Weather:</strong> No weather adjustments (particularly important for passing games).</li>
        <li><strong>Venue effects:</strong> Home/away and dome vs outdoor not yet factored.</li>
      </ul>

      <h2 id="roadmap">10) Roadmap</h2>
      <ul>
        <li>âœ… <strike>Exponential weighting for recent form</strike> (Oct 2024)</li>
        <li>âœ… <strike>L4 rolling window</strike> (Oct 2024)</li>
        <li>âœ… <strike>Injury/role adjustment framework</strike> (Oct 2024)</li>
        <li>âœ… <strike>Defensive matchup framework</strike> (Oct 2024)</li>
        <li>ðŸ”„ Integrate defensive stats into production pipeline</li>
        <li>ðŸ”„ Team context (pace, pass rate, game totals)</li>
        <li>ðŸ”œ Usage-based priors (target share, routes, red-zone touches)</li>
        <li>ðŸ”œ Weather and venue adjustments</li>
        <li>ðŸ”œ Systematic calibration tracking (Brier scores, log loss)</li>
        <li>ðŸ”œ Public post-game grading and calibration charts</li>
        <li>ðŸ”œ Expanded markets (alt lines, first/last TD)</li>
      </ul>

      <hr />
      <p class="note">Questions or suggestions? Find us on GitHub or reach out via the site. We're continuously improving the model and always open to feedback from sharp bettors.</p>
    </div>
  </main>
</body>
</html>
